/*!
 __                                            __    
/\ \                      __                  /\ \__
\ \ \        ___     ___ /\_\    ___      __  \ \ ,_\   ___   _ __
 \ \ \  __  / __`\  /'___\/\ \ /' _ `\  /'__`\ \ \ \/  / __`\/\`'__\
  \ \ \_\ \/\ \_\ \/\ \__/\ \ \/\ \/\ \/\ \_\.\_\ \ \_/\ \_\ \ \ \/ 
   \ \____/\ \____/\ \____\\ \_\ \_\ \_\ \__/.\_\\ \__\ \____/\ \_\ 
    \/___/  \/___/  \/____/ \/_/\/_/\/_/\/__/\/_/ \/__/\/___/  \/_/ 
*/
!function(){"use strict";function a(a,b){var c=null,d={};return d.geolocationAvailable=function(){return b.navigator||b.navigator.geolocation?!0:!1},d.getBrowserCoordinates=function(){var d=a.defer();return this.geolocationAvailable()?b.navigator.geolocation.getCurrentPosition(function(a){c=a.coords,d.resolve(c)},function(a){switch(a.code){case a.PERMISSION_DENIED:d.reject(new Error("Permission denied."));break;case a.POSITION_UNAVAILABLE:d.reject(new Error("The position is currently unavailable."));break;case a.TIMEOUT:d.reject(new Error("The request timed out."));break;default:d.reject(new Error("Unknown error."))}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e5}):d.reject(new Error("Your browser does not support Geolocation.")),d.promise},d.getDistance=function(a,b,c,d){if(!(a&&d&&c&&d))return void 0;var e,f=Math.PI*a/180,g=Math.PI*c/180,h=b-d,i=Math.PI*h/180;return e=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos(i),e=Math.acos(e),e=180*e/Math.PI,e=60*e*1.1515,Math.ceil(100*e)/100},d}a.$inject=["$q","$window"],angular.module("coordinateService",[]).factory("nyplCoordinatesService",a)}(),function(){"use strict";function a(a,b){var c,d,e="?callback=JSON_CALLBACK",f="Could not reach API",g={};return g.getConfig=function(){var a=b.defer();return d?a.resolve(d):(d=window.locations_cfg.config,d?(c=d.api_root,a.resolve(d)):a.reject(f+": config")),a.promise},g.allLocations=function(){var d=b.defer();return a.jsonp(c+"/locations"+e,{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": locations")}),d.promise},g.singleLocation=function(d){var g=b.defer();return a.jsonp(c+"/locations/"+d+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": location")}),g.promise},g.singleDivision=function(d){var g=b.defer();return a.jsonp(c+"/divisions/"+d+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": division")}),g.promise},g.amenities=function(d){var g=b.defer(),h=d?"/amenities/"+d:"/amenities";return a.jsonp(c+h+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": amenities")}),g.promise},g.amenitiesAtLibrary=function(d){var g=b.defer();return a.jsonp(c+"/locations/"+d+"/amenities"+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": library-amenity")}),g.promise},g.alerts=function(){var d=b.defer();return a.jsonp(c+"/alerts"+e,{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": site-wide alerts")}),d.promise},g}a.$inject=["$http","$q"],angular.module("locationService",[]).factory("nyplLocationsService",a)}();var nypl_locations=angular.module("nypl_locations",["ngSanitize","ui.router","ngAnimate","locationService","coordinateService","nyplFeedback","nyplSearch","nyplSSO","nyplNavigation","nyplBreadcrumbs","angulartics","angulartics.google.analytics","pascalprecht.translate","newrelic-timing"]);nypl_locations.constant("_",window._),nypl_locations.config(["$analyticsProvider","$locationProvider","$translateProvider","$stateProvider","$urlRouterProvider","$crumbProvider",function(a,b,c,d,e,f){"use strict";function g(a,b,c){return c.singleLocation(a.location).then(function(a){return a.location}).catch(function(a){throw a})}function h(a,b,c,d){var e=d.singleDivision(b.division),f=d.singleDivision(b.subdivision);return a.all([e,f]).then(function(a){var b=(a[0].division,a[1].division);return b})}function i(a,b,c){return c.singleDivision(a.division).then(function(a){return a.division}).catch(function(a){throw a})}function j(a,b,c){return c.amenities(a.amenity).then(function(a){return a}).catch(function(a){throw a})}function k(a){return a.getConfig()}a.virtualPageviews(!1),b.html5Mode(!0),c.useStaticFilesLoader({prefix:"languages/",suffix:".json"}),c.preferredLanguage("en"),g.$inject=["$stateParams","config","nyplLocationsService"],h.$inject=["$q","$stateParams","config","nyplLocationsService"],i.$inject=["$stateParams","config","nyplLocationsService"],j.$inject=["$stateParams","config","nyplLocationsService"],k.$inject=["nyplLocationsService"],f.setOptions({primaryState:{name:"Home",customUrl:"http://nypl.org"},secondaryState:{name:"Locations",customUrl:"home.index"}}),e.rule(function(a,b){var c=b.url();return"/"===c[c.length-1]?c.slice(0,-1):void 0}),e.otherwise("/404"),d.state("home",{url:"/","abstract":!0,templateUrl:"views/locations.html",controller:"LocationsCtrl",label:"Locations",resolve:{config:k}}).state("home.index",{templateUrl:"views/location-list-view.html",url:"",label:"Locations"}).state("home.list",{templateUrl:"views/location-list-view.html",url:"list",label:"Locations"}).state("home.map",{templateUrl:"views/location-map-view.html",url:"map",controller:"MapCtrl",label:"Locations"}).state("subdivision",{url:"/divisions/:division/:subdivision",templateUrl:"views/division.html",controller:"DivisionCtrl",label:"Division",resolve:{config:k,division:h},data:{parentState:"location",crumbName:"{{division.name}}"}}).state("division",{url:"/divisions/:division",templateUrl:"views/division.html",controller:"DivisionCtrl",label:"Division",resolve:{config:k,division:i},data:{parentState:"location",crumbName:"{{division.name}}"}}).state("amenities",{url:"/amenities",templateUrl:"views/amenities.html",controller:"AmenitiesCtrl",label:"Amenities",resolve:{config:k,amenities:j},data:{crumbName:"Amenities"}}).state("amenity",{url:"/amenities/id/:amenity",templateUrl:"views/amenities.html",controller:"AmenityCtrl",label:"Amenities",resolve:{config:k,amenity:j},data:{parentState:"amenities",crumbName:"{{amenity.amenity.name}}"}}).state("amenities-at-location",{url:"/amenities/loc/:location",templateUrl:"views/amenitiesAtLibrary.html",controller:"AmenitiesAtLibraryCtrl",resolve:{config:k,location:g},data:{parentState:"amenities",crumbName:"{{location.name}}"}}).state("404",{url:"/404",templateUrl:"views/404.html"}).state("location",{url:"/:location",templateUrl:"views/location.html",controller:"LocationCtrl",resolve:{config:k,location:g},data:{crumbName:"{{location.name}}"}})}]),nypl_locations.run(["$analytics","$state","$rootScope","$location",function(a,b,c,d){c.$on("$stateChangeStart",function(){c.close_feedback=!0}),c.$on("$stateChangeSuccess",function(){a.pageTrack("/locations"+d.path()),c.current_url=d.absUrl()}),c.$on("$stateChangeError",function(){b.go("404")})}]),nypl_locations.run(["$rootScope","nyplUtility",function(a,b){a.holiday=b.holidayClosings()}]),nypl_locations.config(["$httpProvider",function(a){"use strict";var b,c=["$q","$injector","$location",function(a,c,d){function e(a){return b=b||c.get("$http"),b.pendingRequests.length<1&&(g=g||c.get("requestNotificationChannel"),g.requestEnded()),a}function f(e){var f=e.status;return b=b||c.get("$http"),b.pendingRequests.length<1&&(g=g||c.get("requestNotificationChannel"),g.requestEnded()),404===f?(d.path("/404"),a.reject(e)):a.reject(e)}var g;return function(a){return g=g||c.get("requestNotificationChannel"),g.requestStarted(),a.then(e,f)}}];a.responseInterceptors.push(c)}]);var nypl_widget=angular.module("nypl_widget",["ngSanitize","ui.router","locationService","coordinateService","angulartics","angulartics.google.analytics"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(a,b){"use strict";function c(a,b,c){return c.singleLocation(a.location).then(function(a){return a.location}).catch(function(a){throw a})}function d(a,b,c,d){var e=d.singleDivision(b.division),f=d.singleDivision(b.subdivision);return a.all([e,f]).then(function(a){var b=(a[0],a[1].division);return b})}function e(a,b,c){return c.singleDivision(a.division).then(function(a){return a.division}).catch(function(a){throw a})}function f(a){return a.getConfig()}c.$inject=["$stateParams","config","nyplLocationsService"],d.$inject=["$q","$stateParams","config","nyplLocationsService"],e.$inject=["$stateParams","config","nyplLocationsService"],f.$inject=["nyplLocationsService"],a.html5Mode(!0),b.state("subdivision",{url:"/widget/divisions/:division/:subdivision",templateUrl:"views/widget.html",controller:"WidgetCtrl",resolve:{config:f,data:d}}).state("division",{url:"/widget/divisions/:division",templateUrl:"views/widget.html",controller:"WidgetCtrl",label:"Division",resolve:{config:f,data:e}}).state("widget",{url:"/widget/:location",templateUrl:"views/widget.html",controller:"WidgetCtrl",resolve:{config:f,data:c}})}]);nypl_widget.run(["$rootScope","nyplUtility",function(a,b){a.holiday=b.holidayClosings()}]),function(){"use strict";function a(){function a(a){var b=a.split(":"),c=(parseInt(b[0],10)+11)%12+1,d=b[1],e=b[0]>=12?"pm":"am";return c+":"+d+e}return function(b){var c=void 0!==b&&void 0!==b.today?b.today:b;return c?null===c.open?"Closed":a(c.open)+" - "+a(c.close):(console.log("timeFormat() filter function error: Argument is not defined or empty, verify API response for time"),"")}}function b(){return function(a){return new Date(a).toISOString()}}function c(){return function(a){return"string"==typeof a?a.replace(/(^|\s)([a-z])/g,function(a){return a.toUpperCase()}):a}}function d(){function a(a){return a=a.split(":"),_.object(["hours","mins","meridian","military"],[(parseInt(a[0],10)+11)%12+1,a[1],a[0]>=12?"pm":"am",a[0]])}return function(b,c){var d,e,f,g,h,i,j,k=new Date,l=k.getHours();if(b){if(g=b.today,h=b.tomorrow,g.open&&(d=a(g.open)),g.close&&(e=a(g.close)),!g.open||!g.close)return console.log("Returned object is undefined for open/closed elems"),"Closed today";if(null!==h.open&&(i=a(h.open)),null!==h.close&&(j=a(h.close)),l>=e.military)return i||j?"Open tomorrow "+i.hours+(0!==parseInt(i.mins,10)?":"+i.mins:"")+i.meridian+"-"+j.hours+(0!==parseInt(j.mins,10)?":"+j.mins:"")+j.meridian:"Closed today";switch(i&&l>=0&&l<i.military&&(c="long"),c){case"short":f="Open today until "+e.hours+(0!==parseInt(e.mins,10)?":"+e.mins:"")+e.meridian;break;case"long":f="Open today "+d.hours+(0!==parseInt(d.mins,10)?":"+d.mins:"")+d.meridian+"-"+e.hours+(0!==parseInt(e.mins,10)?":"+e.mins:"")+e.meridian;break;default:f=d.hours+":"+d.mins+d.meridian+"-"+e.hours+":"+e.mins+e.meridian}return f}return"Not available"}}function e(){return function(a,b,c){return"string"!=typeof a?a:a.length<200?a:(isNaN(b)&&(b=200),void 0===c&&(c="..."),a.length<=b||a.length-c.length<=b?a:String(a).substring(0,b-c.length)+c)}}angular.module("nypl_locations").filter("timeFormat",a).filter("dateToISO",b).filter("capitalize",c).filter("hoursTodayFormat",d).filter("truncate",e),angular.module("nypl_widget").filter("hoursTodayFormat",d)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){b.title=g.name,c.data=g,c.locinator_url="http://www.nypl.org/locations"+a.path().substr(7),c.widget_name=g.name,g._embedded.location&&(c.division=!0,c.data.images.exterior=g.images.interior),f.closed_img&&(c.data.images.closed=f.closed_img),g.hours&&(c.hoursToday=i.hoursToday(g.hours)),c.data.social_media=i.socialMediaColor(c.data.social_media),c.locationDest=i.getAddressString(g)}a.$inject=["$location","$rootScope","$scope","$timeout","$window","config","data","nyplCoordinatesService","nyplUtility"],angular.module("nypl_widget").controller("WidgetCtrl",a)}(),function(){"use strict";function a(a){return{restrict:"A",link:function(b,c){var d=function(){c.addClass("show")},e=function(){c.removeClass("show")};c.hasClass("show")&&c.removeClass("show"),a.onRequestStarted(b,d),a.onRequestEnded(b,e)}}}function b(){return{restrict:"E",templateUrl:"scripts/directives/templates/translatebuttons.html",replace:!0,controller:function(a,b){a.translate=function(a){b.use(a)}}}}function c(){return{restrict:"E",templateUrl:"scripts/directives/templates/todaysHours.html",replace:!0,scope:{hours:"@",holiday:"="}}}function d(){return{restrict:"E",templateUrl:"scripts/directives/templates/emailus.html",replace:!0,scope:{link:"@"}}}function e(a){return{restrict:"E",templateUrl:"scripts/directives/templates/librarianchat.html",replace:!0,link:function(b,c){b.openChat=function(){a.popupWindow("http://www.nypl.org/ask-librarian","NYPL Chat",210,450),c.hasClass("active")||c.addClass("active")}}}}function f(a){return function(b){b.$on("$stateChangeStart",function(){a.scrollTo(0,0)})}}function g(a){function b(a){var b=new Date(a),c=new Date;return b.getTime()>c.getTime()?!0:!1}return{restrict:"E",templateUrl:"scripts/directives/templates/registration.html",replace:!0,scope:{registration:"=",status:"=",link:"="},link:function(c){c.online=!1,c.registration&&(c.eventRegStarted=b(c.registration.start),"Online"==c.registration.type?(c.online=!0,c.reg_msg=c.eventRegStarted?"Online, opens "+a("date")(c.registration.start,"MM/dd"):"Online"):c.reg_msg=c.registration.type)}}}function h(a,b,c){return{restrict:"E",templateUrl:"scripts/directives/templates/alerts.html",replace:!0,link:function(d){var e;a(function(){b.alerts().then(function(a){e=a.alerts,d.sitewidealert=c.alerts(e)})},200)}}}function i(){function a(a,b){var c=new Date(a),d=new Date(b),e=new Date;return c.getTime()<=e.getTime()&&d.getTime()>=e.getTime()?!1:!0}return{restrict:"E",templateUrl:"scripts/directives/templates/library-alert.html",replace:!0,scope:{exception:"="},link:function(b){b.exception&&(b.alertExpired=a(b.exception.start,b.exception.end),""!==b.exception.description&&b.alertExpired===!1&&(b.libraryAlert=b.exception.description))}}}function j(){function a(a,b,c){var d=c.collapse,e=c.className||"open",f=c.duration||"fast";a.$eval(d)||b.hide(),a.$watch(d,function(a,c){a!==c&&(a?b.stop(!0,!0).slideDown(f).addClass(e):b.stop(!0,!0).slideUp(f).removeClass(e))})}return{link:a,restrict:"A"}}function k(a,b){return{restrict:"E",templateUrl:"scripts/directives/templates/fundraising.html",replace:!0,scope:{fundraising:"=fundraising",category:"@"},link:function(c){c.fundraising||a(function(){b.getConfig().then(function(a){var b=a.config.fundraising;c.fundraising={appeal:b.appeal,statement:b.statement,button_label:b.button_label,link:b.link}})},200)}}}function l(){return{restrict:"E",templateUrl:"scripts/directives/templates/sidebar-widgets.html",replace:!0,scope:{donateButton:"@",nyplAsk:"@"},link:function(a,b,c){var d="https://secure3.convio.net/nypl/site/SPageServer?pagename=donation_form&JServSessionIdr003=dwcz55yj27.app304a&s_src=FRQ14ZZ_SWBN";a.donateUrl=c.donateurl||d}}}function m(a){return{restrict:"E",templateUrl:"scripts/directives/templates/footer.html",replace:!0,scope:{},link:function(b,c){var d,e=c.find(".footerlinks a");e.click(function(){d=angular.element(this).attr("href"),a.eventTrack("Click",{category:"footer",label:d})})}}}function n(a,b){return{restrict:"AEC",templateUrl:"scripts/directives/templates/autofill.html",scope:{data:"=",model:"=ngModel",mapView:"&",geoSearch:"&"},link:function(c,d,e,f){function g(){c.$watch("model",function(a){f.updateSearchText(c.data,a)}),c.$on("$stateChangeSuccess",function(){f.resetSearchTerms(),f.closeAutofill()})}c.focused=!1,c.activated=!1,c.geocodingactive=!1,c.filtered=[],c.items,c.active,c.currentIndex;var h=angular.element(document.getElementById("searchTerm")),i=angular.element(document.getElementsByTagName("html"));h.bind("focus",function(){c.$apply(function(){f.openAutofill()})}),h.bind("click",function(a){a.stopPropagation()}),h.bind("keyup",function(d){13===d.keyCode&&c.$apply(function(){c.activated?c.active.slug?(c.activated=!1,f.closeAutofill(),c.model=c.active.name,a.go("location",{location:c.active.slug})):(c.geoSearch({term:c.model}),c.geocodingactive=!1,c.activated=!1,h.blur()&&f.closeAutofill()):f.setSearchText(c.model)?(c.model=c.items[0].name,f.closeAutofill(),b.eventTrack("Accept",{category:"Locations",label:c.model}),a.go("location",{location:c.items[0].slug})):(c.geoSearch({term:c.model}),h.blur()&&f.closeAutofill())}),39===d.keyCode&&c.$apply(function(){f.setSearchText(c.model)}),8===d.keyCode&&c.$apply(function(){c.lookahead=""}),27===d.keyCode}),h.bind("keydown",function(a){(9===a.keyCode||13===a.keyCode||27===a.keyCode)&&a.preventDefault(),38===a.keyCode&&(a.preventDefault(),c.$apply(function(){c.activated?f.activatePreviousItem():f.activateFirstItem()})),40===a.keyCode&&(a.preventDefault(),c.$apply(function(){c.activated?f.activateNextItem():f.activateFirstItem(),f.activateGeocodingItem()}))}),i.bind("click",function(){c.$apply(function(){f.closeAutofill()})}),g()},controller:["$scope",function(a){a.lookahead="",a.currentWord="",a.completeWord="",this.closeAutofill=function(){return a.focused=!1},this.openAutofill=function(){return a.focused=!0},this.activate=function(a){return a},this.activateFirstItem=function(){a.active=a.filtered[0],a.currentIndex=a.filtered.indexOf(a.active),a.activated=!0},this.activateNextItem=function(){a.geocodingactive=!1,a.currentIndex<a.filtered.length&&a.currentIndex>=0?(a.currentIndex=a.filtered.indexOf(a.active)+1,a.active=this.activate(a.filtered[a.currentIndex])):(a.active=void 0,a.currentIndex=-1)},this.activatePreviousItem=function(){a.geocodingactive=!1,-1===a.currentIndex?(a.currentIndex=a.filtered.length-1,a.active=this.activate(a.filtered[a.currentIndex])):a.currentIndex<=a.filtered.length&&a.currentIndex>0&&(a.currentIndex=a.currentIndex-1,a.active=this.activate(a.filtered[a.currentIndex]))},this.activateGeocodingItem=function(){!a.active&&a.activated&&(a.active=this.activate(a.model),a.geocodingactive=!0)},this.setSearchText=function(){return a.completeWord!==a.model&&""!==a.completeWord&&""!==a.model?a.model=a.completeWord:void 0},this.resetSearchTerms=function(){a.lookahead="",a.currentWord=""},this.filterStartsWith=function(a,b){return _.filter(a,function(a){return a.name?a.name.substring(0,b.length).toLowerCase()===b.toLowerCase():!1})},this.filterTermWithin=function(a,b){return _.filter(a,function(a){return a.name?a.name.toLowerCase().indexOf(b.toLowerCase())>=0:!1})},this.updateSearchText=function(b,c){return""!==c&&c&&b&&c.length>1?(a.items=this.filterStartsWith(b,c),a.filtered=this.filterTermWithin(b,c),a.items[0]?(a.lookahead=a.items[0].name.substring(c.length),a.currentWord=c):this.resetSearchTerms(),a.completeWord=a.currentWord+a.lookahead):void 0}}]}}a.$inject=["requestNotificationChannel"],e.$inject=["nyplUtility"],f.$inject=["$window"],g.$inject=["$filter"],h.$inject=["$timeout","nyplLocationsService","nyplUtility"],i.$inject=["nyplUtility"],k.$inject=["$timeout","nyplLocationsService"],m.$inject=["$analytics"],n.$inject=["$state","$analytics"],angular.module("nypl_locations").directive("loadingWidget",a).directive("nyplTranslate",b).directive("todayshours",c).directive("emailusbutton",d).directive("librarianchatbutton",e).directive("scrolltop",f).directive("eventRegistration",g).directive("nyplSiteAlerts",h).directive("nyplLibraryAlert",i).directive("nyplFundraising",k).directive("nyplSidebar",l).directive("nyplAutofill",n).directive("collapse",j).directive("nyplFooter",m),angular.module("nypl_widget").directive("todayshours",c).directive("nyplFundraising",k).directive("librarianchatbutton",e).directive("emailusbutton",d)}(),function(){"use strict";function a(a){var b="_START_REQUEST_",c="_END_REQUEST_",d={};return d.requestStarted=function(){a.$broadcast(b)},d.requestEnded=function(){a.$broadcast(c)},d.onRequestStarted=function(a,c){a.$on(b,function(a){c(a)})},d.onRequestEnded=function(a,b){a.$on(c,function(a){b(a)})},d}function b(a,b,c){var d={};return d.hoursToday=function(a){var b,c=new Date,d=c.getDay(),e=d+1;return a&&(b={today:{day:a.regular[d].day,open:a.regular[d].open,close:a.regular[d].close},tomorrow:{day:a.regular[e%7].day,open:a.regular[e%7].open,close:a.regular[e%7].close}}),b},d.formatDate=function(a,b){var c,d=["January","February","March","April","May","June","July","August","September","October","November","December"];if(this.numDaysFromToday=function(a,b){return Math.round((a.valueOf()-b.valueOf())/1e3/86400-.5)},a&&b){var e=new Date(a),f=new Date(b),g=new Date,h=this.numDaysFromToday(f,g);if(!h)return;c=365>=h?e.getTime()<=g.getTime()&&f.getTime()>=g.getTime()?"Now through "+d[f.getUTCMonth()]+" "+f.getUTCDate()+", "+f.getUTCFullYear():e.getTime()>g.getTime()&&f.getTime()>=g.getTime()?"Opening "+d[e.getUTCMonth()]+" "+e.getUTCDate()+", "+e.getUTCFullYear():d[e.getUTCMonth()]+" "+e.getUTCDate()+", "+e.getUTCFullYear()+" through "+d[f.getUTCMonth()]+" "+f.getUTCDate()+", "+f.getUTCFullYear():"Ongoing"}return c},d.branchException=function(a){var b={};if(a){if(!a.exceptions)return null;if(""!==a.exceptions.description.trim())return b.desc=a.exceptions.description,a.exceptions.start&&(b.start=a.exceptions.start),a.exceptions.end&&(b.end=a.exceptions.end),b}return null},d.getAddressString=function(a,b){if(!a)return"";var c=" ",d=a.name;return b&&(c="<br />",d="<a href='/locations/"+a.slug+"'>"+a.name+"</a>"),d+c+a.street_address+c+a.locality+", "+a.region+", "+a.postal_code},d.socialMediaColor=function(a){return _.each(a,function(a){switch(a.classes="icon-",a.site){case"facebook":a.classes+=a.site+" blueDarkerText";break;case"foursquare":a.classes+=a.site+" blueText";break;case"instagram":a.classes+=a.site+" blackText";break;case"twitter":a.classes+=a.site+"2 blueText";break;case"tumblr":a.classes+=a.site+"2 indigoText";break;case"youtube":case"pinterest":a.classes+=a.site+" redText";break;default:a.classes+=a.site}}),a},d.alerts=function(a){var b,c,d=new Date,e=[];return a&&Array.isArray(a)&&a.length>0&&(_.each(a,function(a){b=new Date(a.start),c=new Date(a.end),d>=b&&c>=d&&e.push(a.body)}),!angular.isUndefined(e))?e:null},d.holidayClosings=function(a){function b(a,b){return a.getFullYear()===b.getFullYear()&&a.getDate()===b.getDate()&&a.getMonth()===b.getMonth()}var c,d=a||new Date,e=[{day:new Date(2014,10,27),title:"Closed for Thanksgiving Day"},{day:new Date(2014,11,24),title:"The Library will close at 5 p.m. today"},{day:new Date(2014,11,25),title:"Closed for Christmas Day"},{day:new Date(2014,11,31),title:"The Library will close at 5 p.m. today"}];return c=_.filter(e,function(a){return b(a.day,d)?a:void 0}),c.length>0?{day:c[0].day,title:c[0].title}:void 0},d.popupWindow=function(a,c,d,e){var f,g,h,i,j;a&&(f=void 0===d?"300":"string"==typeof d||d instanceof String?d:d.toString(),g=void 0===e?"500":"string"==typeof d||d instanceof String?e:e.toString(),a&&c?h=b.open(a,c,"menubar=1,resizable=1,width="+f+",height="+g):a&&(h=b.open(a,"","menubar=1,resizable=1,width="+f+",height="+g)),h&&(j=parseInt(f,10),i=parseInt(g,10),h.moveTo(screen.width/2-j/2,screen.height/2-i/2)))},d.calendarLink=function(a,b,c){if(!a||!b||!c)return"";var d=b.title,e=b.start.replace(/[\-:]/g,""),f=b.end.replace(/[\-:]/g,""),g=b.body,h=b._links.self.href,i=c.name+" - "+c.street_address+" "+c.locality+", "+c.region+" "+c.postal_code,j="";switch(a){case"google":j="https://www.google.com/calendar/render?action=template&text="+d+"&dates="+e+"/"+f+"&details="+g+"&location="+i+"&pli=1&uid=&sf=true&output=xml";break;case"yahoo":j="https://calendar.yahoo.com/?v=60&TITLE="+d+"&ST="+e+"&in_loc="+i+"&in_st="+i+"&DESC="+g+"&URL="+h}return j},d.icalLink=function(a,c){if(!a||!c)return"";var d=(new Date).toJSON().toString().replace(/[\-.:]/g,""),e="http://nypl.org/"+a._links.self.href,f="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//NYPL//NONSGML v1.0//EN\nMETHOD:PUBLISH\nBEGIN:VEVENT\nUID:"+(new Date).getTime()+"\nDTSTAMP:"+d+"\nATTENDEE;CN=My Self ;\nORGANIZER;CN=NYPL:\nDTSTART:"+a.start.replace(/[\-:]/g,"")+"\nDTEND:"+a.end.replace(/[\-:]/g,"")+"\nLOCATION:"+c+"\nDESCRIPTION:"+a.body+"\nURL;VALUE=URI:"+e+"\nSUMMARY:"+a.title+"\nEND:VEVENT\nEND:VCALENDAR",g="data:text/calendar;chartset=utf-8,"+encodeURI(f);return b.open(g),g},d.calcDistance=function(a,b){if(!a)return[];var d={latitude:b.latitude||b.lat,longitude:b.longitude||b.long};return _.each(a,function(a){var b,e,f=[];a.geolocation&&a.geolocation.coordinates&&(f=a.geolocation.coordinates),b=a.lat||f[1],e=a.long||f[0],a.distance=c.getDistance(d.latitude,d.longitude,b,e)}),a},d.checkDistance=function(a){var b=_.pluck(a,"distance");return _.min(b)>25?!0:!1},d.returnHTML=function(b){return a.trustAsHtml(b)},d.divisionHasAppointment=function(a,b){return _.contains(a,b)},d.researchLibraryOrder=function(a,b){return _.indexOf(a,b)},d}a.$inject=["$rootScope"],b.$inject=["$sce","$window","nyplCoordinatesService"],angular.module("nypl_locations").factory("nyplUtility",b).factory("requestNotificationChannel",a),angular.module("nypl_widget").factory("nyplUtility",b).factory("requestNotificationChannel",a)}();