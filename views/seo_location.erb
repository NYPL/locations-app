<!doctype html>
<html>
  <head>
    <title>NYPL | <%= @location.name %></title>
  </head>
  <body>
    <div itemscope itemtype="http://schema.org/Library">
      <h1 itemprop="name"><%= @location.name %></h1>
      <div itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
        <img src="<%= @location.images['exterior'] %>" 
             alt="Image of <%= @location.name %>"
             itemprop="contentUrl" />
      </div>
      <div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
        <div itemprop="streetAddress"><%= @location.street_address %></div>
        <div>
          <span itemprop="addressLocality"><%= @location.locality %></span>
          <span itemprop="addressRegion"><%= @location.region %></span>
          <span itemprop="postalCode"><%= @location.postal_code %></span>
        </div>
        <% if ! @location.contacts.nil? %>
        <div itemprop="telephone"><%= @location.phone %></div>
        <% end %>
      </div>

      <div itemprop="geo" itemscope itemtype="http://schema.org/GeoCoordinates">
        <meta itemprop="longitude" content="<%= @location.geolocation['coordinates'][0] %>" />
        <meta itemprop="latitude" content="<%= @location.geolocation['coordinates'][1] %>" />
      </div>
      <div itemprop="contactPoint" itemscope itemtype="http://schema.org/ContactPoint">
        <span itemprop="contactType">Library Manager</span>
        <span itemprop="name"><%= @location.contacts['manager'] %></span>
      </div>

      <h2>Hours</h2>
      <table>
        <thead>
          <tr>
            <td>Day</td>
            <td>Hours</td>
          </tr>
        </thead>
        <tbody>
        <% @location.hours.each do |day| %>
        <% if day.closedOn? %>
          <tr>
            <td><%= day.day %></td>
            <td>Closed</td>
          </tr>
        <% else %>
          <tr itemprop="openingHours" content="">
            <td><%= day.day %></td>
            <td><%= day.open %>-<%= day.close %></td>
          </tr>
        <% end %>
        <% end %>
        </tbody>
      </table>

      <h2>Amenities</h2>
      <ul>
      <% @location.amenities.each do |a| %>
        <li itemprop="makesOffer" itemscope itemtype="http://schema.org/Offer">
          <a href="../amenities/id/<%= a.amenity.id %>">
            <span itemprop="name"><%= a.amenity.name %></span>
          </a>

          <% if a.amenity.info? %>
            <div>
              <a href="<%= a.amenity.info.href %>">
                <% if a.amenity.info.name.nil? %>
                  Learn More
                <% else %>
                  <%= a.amenity.info.name %>
                <% end %>
              </a>
            </div>
          <% end %>

          <% if a.amenity.action? %>
            <div><a href="<%= a.amenity.action.href %>"><%= a.amenity.action.name %></a></div>
          <% end %>
        </li>
      <% end %>
      </ul>

      <div>
        <a href="../amenities/loc/<%= @location.slug %>">See all amenities</a>
      </div>

      <h2>About</h2>
      <div itemprop="description">
        <div itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
          <img src="<%= @location.images['interior'] %>" 
               alt="Image of <%= @location.name %> interior"
               itemprop="contentUrl" />
        </div>

        <%= @location.about %>
      </div>

      <% if @location.features.count > 0 %>
      <h2>Features</h2>
      <ul>
      <% @location.features.each do |f| %>
        <li>
          <% if f.links.nil? %>
          <h3><%= f.title %>
          <% else %>
          <h3><a href="<%= f.links['self']['href'] %>"><%= f.title %></a></h3>
          <% end %>

          <% if ! f.image.nil? %>
          <img src="<%= f.image %>" />
          <% end %>

          <div><%= f.body %></div>
        </li>
      <% end %>
      </ul>
      <% end %>

      <% if @location.embedded['blogs'] %>
      <h2>Blogs</h2>
      <% @location.embedded['blogs'].each do |blog| %>
        <li>
          <h3><a href="<%= blog['_links']['self']['href'] %>"><%= blog['title'] %></a></h3>
          <div>
            <%= blog['author']['name'] %>
            <%= blog['author']['position'] %>
            <%= blog['author']['location'] %> 
            <%= blog['pubdate'] %> 
          </div>
          <div><%= blog['body'] %></div>
        </li>
      <% end %>
      <% end %>

    </div>
  </body>
</html>